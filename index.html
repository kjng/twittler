<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        
        var loadPage = function() {

          $body.html('');

          for (var i = streams.home.length - 1; i >= 0; i--) {
            var tweet = streams.home[i];
            var tweetTime = tweet.created_at;
            var time = (function() {
              var amOrPm = 'am';
              var convHours = tweetTime.getHours();
              var convMinutes = tweetTime.getMinutes().toString();

              if (tweetTime.getHours() >= 12) {
                convHours = tweetTime.getHours() % 12;
                amOrPm = 'pm';
              }

              if (convMinutes.length === 1) {
                convMinutes = '0' + convMinutes;
              }

              return convHours + ':' + convMinutes + ' ' + amOrPm;
            })();
            var $tweet = $('<div class="' + tweet.user + '"></div>');
            $tweet.text(time + ' ' + '@');
            $tweet.append('<a class="user" href="#">' + tweet.user + '</a>');
            $tweet.append(': ' + tweet.message);
            $tweet.appendTo($body);
          }
        };
        loadPage();
        var interval = setInterval(loadPage, 3000);

        $body.on('click', 'a.user', function() {
          var myClass = "." + $(this).closest('div').attr('class');
          $("div").not(myClass).hide();
          clearInterval(interval);
          $body.append('<a id="back" href="#">Back</a>');
        });

        $body.on('click', '#back', function() {
          loadPage();
          interval = setInterval(loadPage, 3000);
        });

      });

    </script>
  </body>
</html>
